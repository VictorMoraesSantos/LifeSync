<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:enums="clr-namespace:LifeSyncApp.Models.TaskManager.Enums"
             xmlns:taskitem="clr-namespace:LifeSyncApp.Views.TaskManager.TaskItem"
             xmlns:viewmodels="clr-namespace:LifeSyncApp.ViewModels.TaskManager"
             xmlns:models="clr-namespace:LifeSyncApp.Models.TaskManager"
             x:Class="LifeSyncApp.Views.TaskManager.TaskItem.TaskItemDetailPage"
             x:DataType="viewmodels:TaskItemsViewModel"
             Shell.NavBarIsVisible="False"
             BackgroundColor="White">

    <Grid>

        <Grid RowDefinitions="Auto, Auto, *, Auto"
              RowSpacing="0">
            <Grid Grid.Row="0"
                  ColumnDefinitions="Auto,*,Auto,Auto"
                  Padding="16,12"
                  BackgroundColor="White">
                <HorizontalStackLayout Grid.Column="0"
                                       Spacing="6"
                                       VerticalOptions="Center">
                    <HorizontalStackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoBackCommand}" />
                    </HorizontalStackLayout.GestureRecognizers>

                    <Image Source="arrow_back.svg"
                           WidthRequest="16"
                           HeightRequest="16"
                           VerticalOptions="Center"/>

                    <Button Text="Voltar"
                            BackgroundColor="Transparent"
                            TextColor="#6B7280"
                            FontSize="14"
                            Padding="0"
                            Command="{Binding GoBackCommand}"/>

                </HorizontalStackLayout>

                <ImageButton Grid.Column="2"
                             Source="edit.svg"
                             BackgroundColor="Transparent"
                             WidthRequest="36"
                             HeightRequest="36"
                             Padding="8"
                             Command="{Binding EditTaskCommand}"/>

                <ImageButton Grid.Column="3"
                             Source="trash.svg"
                             BackgroundColor="Transparent"
                             WidthRequest="36"
                             HeightRequest="36"
                             Padding="8"
                             Command="{Binding DeleteTaskCommand}"/>
            </Grid>

            <BoxView Grid.Row="1"
                     HeightRequest="1"
                     Color="#E0E0E0"
                     VerticalOptions="End"/>

            <ScrollView Grid.Row="2" Padding="16,20">
                <VerticalStackLayout Spacing="18">

                    <Label Text="{Binding SelectedTask.Title}"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#111"
                           LineBreakMode="WordWrap"/>

                    <Label Text="{Binding SelectedTask.Description}"
                           FontSize="14"
                           TextColor="#6B7280"
                           LineBreakMode="WordWrap"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto" ColumnSpacing="12">

                        <Label Text="Status" FontSize="12" TextColor="#6B7280" VerticalOptions="Center"/>

                        <Border Grid.Column="1"
                                Stroke="#E5E7EB"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 10"
                                Padding="10,6"
                                BackgroundColor="#F9FAFB"
                                HorizontalOptions="End">
                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">

                                <Ellipse WidthRequest="10"
                                         HeightRequest="10"
                                         Fill="{Binding SelectedTask.Status, Converter={StaticResource StatusToColorConverter}}"
                                         VerticalOptions="Center"/>

                                <Label Text="{Binding SelectedTask.Status}"
                                       FontSize="13"
                                       TextColor="#111"
                                       VerticalOptions="Center"/>

                            </HorizontalStackLayout>
                        </Border>
                    </Grid>

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">

                        <Label Text="Prioridade" FontSize="12" TextColor="#6B7280" VerticalOptions="Center"/>

                        <Border Grid.Column="1"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 10"
                                Padding="12,6"
                                BackgroundColor="#E8F0FF"
                                HorizontalOptions="End">
                            <Label Text="{Binding SelectedTask.Priority}"
                                   FontSize="13"
                                   TextColor="#2563EB"/>
                        </Border>
                    </Grid>

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">

                        <Label Text="Vencimento" FontSize="12" TextColor="#6B7280" VerticalOptions="Center"/>

                        <Grid Grid.Column="1" ColumnDefinitions="Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">

                            <Image Source="calendar.svg"
                                   WidthRequest="16"
                                   HeightRequest="16"
                                   VerticalOptions="Center"
                                   Opacity="0.75"/>

                            <Label Grid.Column="1"
                                   Text="{Binding SelectedTask.DueDate}"
                                   FontSize="13"
                                   TextColor="#DC2626"
                                   VerticalOptions="Center"/>

                        </Grid>
                    </Grid>

                    <Grid ColumnDefinitions="Auto,*"
                          ColumnSpacing="10"
                          VerticalOptions="Center">
                        <Image Source="label.svg" WidthRequest="16" HeightRequest="16" Opacity="0.75"/>
                        <Label Grid.Column="1" Text="Etiquetas" FontSize="12" TextColor="#6B7280" VerticalOptions="Center"/>
                    </Grid>

                    <VerticalStackLayout Spacing="8">
                        <FlexLayout Wrap="Wrap"
                                    JustifyContent="Start"
                                    AlignItems="Start"
                                    BindableLayout.ItemsSource="{Binding SelectedTask.Labels}">
                            <BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="models:TaskLabel">
                                    <Border Stroke="#E5E7EB"
                                            StrokeThickness="1"
                                            StrokeShape="RoundRectangle 10"
                                            Padding="10,6"
                                            BackgroundColor="White"
                                            Margin="0,0,8,8">
                                        <HorizontalStackLayout Spacing="8">
                                            <Ellipse WidthRequest="10"
                                                     HeightRequest="10"
                                                     Fill="{Binding LabelColor, Converter={StaticResource LabelColorToConverter}}"
                                                     VerticalOptions="Center"/>
                                            <Label Text="{Binding Name}"
                                                   FontSize="13"
                                                   TextColor="#111"
                                                   VerticalOptions="Center"/>
                                        </HorizontalStackLayout>
                                    </Border>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                            <BindableLayout.EmptyViewTemplate>
                                <DataTemplate>
                                    <Label Text="Nenhuma etiqueta"
                                           FontSize="12"
                                           TextColor="#9CA3AF"
                                           Margin="0,4"/>
                                </DataTemplate>
                            </BindableLayout.EmptyViewTemplate>
                        </FlexLayout>
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="#EEEEEE" Margin="0,4,0,0"/>

                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*" RowSpacing="8" ColumnSpacing="12">
                        <Label Grid.Row="0" Grid.Column="0" Text="Criada em" FontSize="12" TextColor="#6B7280"/>
                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding SelectedTask.CreatedAt}" FontSize="12" TextColor="#111" HorizontalTextAlignment="End"/>

                        <Label Grid.Row="1" Grid.Column="0" Text="Atualizada em" FontSize="12" TextColor="#6B7280"/>
                        <Label Grid.Row="1" Grid.Column="1" Text="{Binding SelectedTask.UpdatedAt}" FontSize="12" TextColor="#111" HorizontalTextAlignment="End"/>
                    </Grid>

                </VerticalStackLayout>
            </ScrollView>

            <Grid Grid.Row="3" RowDefinitions="Auto,Auto" Padding="16,12" RowSpacing="12">

                <BoxView Grid.Row="0" HeightRequest="1" Color="#EEEEEE" Margin="-16,0,-16,0"/>

                <Grid Grid.Row="1" ColumnDefinitions="*,*" ColumnSpacing="12">

                    <Button Text="Excluir"
                            BackgroundColor="White"
                            TextColor="#DC2626"
                            BorderColor="#FCA5A5"
                            BorderWidth="1"
                            CornerRadius="10"
                            HeightRequest="44"
                            Command="{Binding DeleteTaskCommand}"/>

                    <Button Grid.Column="1"
                            Text="Editar"
                            BackgroundColor="#111"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="44"
                            Command="{Binding EditTaskCommand}"/>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>
