<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LifeSyncApp.ViewModels.Financial"
             xmlns:enums="clr-namespace:LifeSyncApp.Models.Financial.Enums"
             xmlns:controls="clr-namespace:LifeSyncApp.Controls"
             x:Class="LifeSyncApp.Views.Financial.ManageTransactionPage"
             x:DataType="vm:ManageTransactionViewModel"
             Title="{Binding PageTitle}"
             BackgroundColor="#F9FAFB">

    <ScrollView Padding="20">
        <VerticalStackLayout Spacing="24">
            
            <!-- Seleção de Tipo com Design Premium -->
            <VerticalStackLayout Spacing="12">
                <Label Text="Tipo de Transação"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="#111827" />
                
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <!-- Botão Receita -->
                    <Border Grid.Column="0"
                            BackgroundColor="{Binding IsIncome, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#10B981:#FFFFFF'}"
                            Stroke="{Binding IsIncome, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Transparent:#E5E7EB'}"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 16"
                            Padding="16"
                            HeightRequest="60">
                        <Border.Shadow>
                            <Shadow Brush="{Binding IsIncome, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#10B981:Transparent'}" 
                                    Opacity="0.2" 
                                    Radius="8" 
                                    Offset="0,4" />
                        </Border.Shadow>
                        
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SelectTypeCommand}"
                                                  CommandParameter="{x:Static enums:TransactionType.Income}" />
                        </Border.GestureRecognizers>
                        
                        <VerticalStackLayout Spacing="4" 
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center">
                            <Label Text="↑"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{Binding IsIncome, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFFFFF:#10B981'}"
                                   HorizontalOptions="Center" />
                            <Label Text="Receita"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{Binding IsIncome, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFFFFF:#6B7280'}"
                                   HorizontalOptions="Center" />
                        </VerticalStackLayout>
                    </Border>
                    
                    <!-- Botão Despesa -->
                    <Border Grid.Column="1"
                            BackgroundColor="{Binding IsExpense, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#EF4444:#FFFFFF'}"
                            Stroke="{Binding IsExpense, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Transparent:#E5E7EB'}"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 16"
                            Padding="16"
                            HeightRequest="60">
                        <Border.Shadow>
                            <Shadow Brush="{Binding IsExpense, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#EF4444:Transparent'}" 
                                    Opacity="0.2" 
                                    Radius="8" 
                                    Offset="0,4" />
                        </Border.Shadow>
                        
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SelectTypeCommand}"
                                                  CommandParameter="{x:Static enums:TransactionType.Expense}" />
                        </Border.GestureRecognizers>
                        
                        <VerticalStackLayout Spacing="4" 
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center">
                            <Label Text="↓"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{Binding IsExpense, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFFFFF:#EF4444'}"
                                   HorizontalOptions="Center" />
                            <Label Text="Despesa"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{Binding IsExpense, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFFFFF:#6B7280'}"
                                   HorizontalOptions="Center" />
                        </VerticalStackLayout>
                    </Border>
                </Grid>
            </VerticalStackLayout>

            <!-- Campo de Valor -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Valor *"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="#111827" />
                
                <Border BackgroundColor="White"
                        Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 12"
                        Padding="16,12"
                        HeightRequest="56">
                    <Entry Placeholder="0,00"
                           Keyboard="Numeric"
                           Text="{Binding Amount}"
                           FontSize="16"
                           TextColor="#111827"
                           PlaceholderColor="#9CA3AF"
                           VerticalOptions="Center" />
                </Border>
            </VerticalStackLayout>

            <!-- Campo de Descrição -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Descrição *"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="#111827" />
                
                <Border BackgroundColor="White"
                        Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 12"
                        Padding="16,12"
                        HeightRequest="120">
                    <Editor Placeholder="Digite a descrição da transação..."
                            Text="{Binding Description}"
                            FontSize="16"
                            TextColor="#111827"
                            PlaceholderColor="#9CA3AF"
                            AutoSize="TextChanges" />
                </Border>
            </VerticalStackLayout>

            <!-- Data da Transação -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Data"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="#111827" />
                
                <Border BackgroundColor="White"
                        Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 12"
                        Padding="16,12"
                        HeightRequest="56">
                    <DatePicker Date="{Binding TransactionDate}"
                                Format="dd/MM/yyyy"
                                FontSize="16"
                                TextColor="#111827"
                                VerticalOptions="Center" />
                </Border>
            </VerticalStackLayout>

            <!-- Método de Pagamento -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Método de Pagamento"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="#111827" />
                
                <Border BackgroundColor="White"
                        Stroke="#E5E7EB"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 12"
                        Padding="16,12"
                        HeightRequest="56">
                    <Picker SelectedItem="{Binding SelectedPaymentMethod}"
                            FontSize="16"
                            TextColor="#111827"
                            VerticalOptions="Center">
                        <Picker.ItemsSource>
                            <x:Array Type="{x:Type enums:PaymentMethod}">
                                <enums:PaymentMethod>Cash</enums:PaymentMethod>
                                <enums:PaymentMethod>CreditCard</enums:PaymentMethod>
                                <enums:PaymentMethod>DebitCard</enums:PaymentMethod>
                                <enums:PaymentMethod>BankTransfer</enums:PaymentMethod>
                                <enums:PaymentMethod>Pix</enums:PaymentMethod>
                                <enums:PaymentMethod>Other</enums:PaymentMethod>
                            </x:Array>
                        </Picker.ItemsSource>
                    </Picker>
                </Border>
            </VerticalStackLayout>

            <!-- Botões de Ação -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,8,0,20">
                <!-- Botão Cancelar -->
                <Border Grid.Column="0" 
                        BackgroundColor="White"
                        Stroke="#E5E7EB"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 12"
                        Padding="16"
                        HeightRequest="56">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding CancelCommand}" />
                    </Border.GestureRecognizers>
                    
                    <Label Text="Cancelar"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#6B7280"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                </Border>
                
                <!-- Botão Salvar -->
                <Border Grid.Column="1" 
                        BackgroundColor="#6366F1"
                        Stroke="Transparent"
                        StrokeShape="RoundRectangle 12"
                        Padding="16"
                        HeightRequest="56">
                    <Border.Shadow>
                        <Shadow Brush="#6366F1" Opacity="0.3" Radius="12" Offset="0,4" />
                    </Border.Shadow>
                    
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SaveCommand}" />
                    </Border.GestureRecognizers>
                    
                    <Label Text="Salvar"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                </Border>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>

    <!-- Loading Overlay -->
    <Grid IsVisible="{Binding IsBusy}">
        <BoxView BackgroundColor="Black" Opacity="0.5" />
        <Border BackgroundColor="White"
                StrokeShape="RoundRectangle 16"
                Stroke="Transparent"
                Padding="32,24"
                WidthRequest="200"
                HeightRequest="200"
                HorizontalOptions="Center"
                VerticalOptions="Center">
            <VerticalStackLayout Spacing="16"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center">
                <ActivityIndicator IsRunning="True"
                                   Color="#6366F1"
                                   WidthRequest="48"
                                   HeightRequest="48" />
                <Label Text="Salvando..."
                       FontSize="14"
                       TextColor="#6B7280"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>
        </Border>
    </Grid>

</ContentPage>
