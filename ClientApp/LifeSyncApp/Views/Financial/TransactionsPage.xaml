<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LifeSyncApp.ViewModels.Financial"
             xmlns:models="clr-namespace:LifeSyncApp.Models.Financial"
             xmlns:controls="clr-namespace:LifeSyncApp.Controls"
             x:Class="LifeSyncApp.Views.Financial.TransactionsPage"
             x:DataType="vm:TransactionsViewModel"
             Title=""
             BackgroundColor="#F9FAFB">

    <Grid RowDefinitions="Auto,Auto,*" RowSpacing="0">
        
        <!-- Header com Gradiente Premium -->
        <Grid Grid.Row="0" 
              Padding="20,50,20,30">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#6366F1" Offset="0" />
                    <GradientStop Color="#4F46E5" Offset="1" />
                </LinearGradientBrush>
            </Grid.Background>
            
            <VerticalStackLayout Spacing="4">
                <Label Text="Minhas FinanÃ§as"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="White" />
                       
                <Label Text="Gerencie suas receitas e despesas"
                       FontSize="14"
                       TextColor="White"
                       Opacity="0.9" />
            </VerticalStackLayout>
        </Grid>

        <!-- Cards de Resumo -->
        <Grid Grid.Row="1" 
              ColumnDefinitions="*,*,*" 
              ColumnSpacing="12"
              Padding="20,20,20,16"
              Margin="0,-30,0,0">
            
            <!-- Saldo Total -->
            <Border Grid.Column="0" 
                    BackgroundColor="White"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 16"
                    Padding="12">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.08" Radius="12" Offset="0,4" />
                </Border.Shadow>
                
                <VerticalStackLayout Spacing="4">
                    <Label Text="Saldo"
                           FontSize="11"
                           TextColor="#6B7280" />
                    <Label Text="R$ 5.430"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#111827" />
                </VerticalStackLayout>
            </Border>
            
            <!-- Receitas -->
            <Border Grid.Column="1" 
                    BackgroundColor="White"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 16"
                    Padding="12">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.08" Radius="12" Offset="0,4" />
                </Border.Shadow>
                
                <VerticalStackLayout Spacing="4">
                    <Label Text="Receitas"
                           FontSize="11"
                           TextColor="#6B7280" />
                    <Label Text="R$ 8.500"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#10B981" />
                </VerticalStackLayout>
            </Border>
            
            <!-- Despesas -->
            <Border Grid.Column="2" 
                    BackgroundColor="White"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 16"
                    Padding="12">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.08" Radius="12" Offset="0,4" />
                </Border.Shadow>
                
                <VerticalStackLayout Spacing="4">
                    <Label Text="Despesas"
                           FontSize="11"
                           TextColor="#6B7280" />
                    <Label Text="R$ 3.070"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#EF4444" />
                </VerticalStackLayout>
            </Border>
        </Grid>

        <!-- Ãrea de ConteÃºdo -->
        <Grid Grid.Row="2" Padding="20,0,20,0">
            <VerticalStackLayout Spacing="16">
                
                <!-- Pills de Filtro -->
                <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                    <HorizontalStackLayout Spacing="8">
                        <!-- Todas -->
                        <Border BackgroundColor="#6366F1"
                                Stroke="Transparent"
                                StrokeShape="RoundRectangle 20"
                                Padding="16,8">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding FilterByTypeCommand}" CommandParameter="{x:Null}" />
                            </Border.GestureRecognizers>
                            <Label Text="Todas"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="White" />
                        </Border>
                        
                        <!-- Receitas -->
                        <Border BackgroundColor="White"
                                Stroke="#E5E7EB"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 20"
                                Padding="16,8">
                            <Label Text="Receitas"
                                   FontSize="14"
                                   TextColor="#6B7280" />
                        </Border>
                        
                        <!-- Despesas -->
                        <Border BackgroundColor="White"
                                Stroke="#E5E7EB"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 20"
                                Padding="16,8">
                            <Label Text="Despesas"
                                   FontSize="14"
                                   TextColor="#6B7280" />
                        </Border>
                    </HorizontalStackLayout>
                </ScrollView>

                <!-- Lista de TransaÃ§Ãµes -->
                <RefreshView IsRefreshing="{Binding IsRefreshing}"
                             Command="{Binding RefreshCommand}">
                    
                    <CollectionView ItemsSource="{Binding FilteredTransactions}"
                                    SelectionMode="None">
                        
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
                        </CollectionView.ItemsLayout>
                        
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Transaction">
                                <SwipeView>
                                    <SwipeView.RightItems>
                                        <SwipeItems>
                                            <SwipeItem Text="Editar"
                                                       BackgroundColor="#6366F1"
                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsViewModel}}, Path=EditTransactionCommand}"
                                                       CommandParameter="{Binding .}" />
                                            
                                            <SwipeItem Text="Excluir"
                                                       BackgroundColor="#EF4444"
                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsViewModel}}, Path=DeleteTransactionCommand}"
                                                       CommandParameter="{Binding .}" />
                                        </SwipeItems>
                                    </SwipeView.RightItems>
                                    
                                    <!-- Card Premium de TransaÃ§Ã£o -->
                                    <Border BackgroundColor="White"
                                            Stroke="Transparent"
                                            StrokeShape="RoundRectangle 16"
                                            Padding="16">
                                        <Border.Shadow>
                                            <Shadow Brush="Black" Opacity="0.05" Radius="8" Offset="0,2" />
                                        </Border.Shadow>
                                        
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                            
                                            <!-- Ãcone com CÃ­rculo -->
                                            <Border Grid.Column="0"
                                                    BackgroundColor="{Binding TransactionTypeColor}"
                                                    Stroke="Transparent"
                                                    StrokeShape="RoundRectangle 28"
                                                    WidthRequest="56"
                                                    HeightRequest="56"
                                                    Opacity="0.15">
                                                <Label Text="{Binding Category.Icon}"
                                                       FontSize="24"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center" />
                                            </Border>
                                            
                                            <!-- Detalhes da TransaÃ§Ã£o -->
                                            <VerticalStackLayout Grid.Column="1" 
                                                                 Spacing="4" 
                                                                 VerticalOptions="Center">
                                                <Label Text="{Binding Description}"
                                                       FontSize="15"
                                                       FontAttributes="Bold"
                                                       TextColor="#111827" />
                                                
                                                <Label Text="{Binding Category.Name}"
                                                       FontSize="13"
                                                       TextColor="#6B7280" />
                                                
                                                <Label Text="{Binding FormattedDate}"
                                                       FontSize="12"
                                                       TextColor="#9CA3AF" />
                                            </VerticalStackLayout>
                                            
                                            <!-- Valor -->
                                            <VerticalStackLayout Grid.Column="2" 
                                                                 Spacing="2"
                                                                 VerticalOptions="Center"
                                                                 HorizontalOptions="End">
                                                <Label Text="{Binding FormattedAmount}"
                                                       FontSize="17"
                                                       FontAttributes="Bold"
                                                       TextColor="{Binding TransactionTypeColor}"
                                                       HorizontalOptions="End" />
                                                
                                                <Border BackgroundColor="{Binding TransactionTypeColor}"
                                                        Stroke="Transparent"
                                                        StrokeShape="RoundRectangle 10"
                                                        Padding="8,2"
                                                        Opacity="0.15">
                                                    <Label Text="{Binding PaymentMethodDisplay}"
                                                           FontSize="11"
                                                           TextColor="{Binding TransactionTypeColor}"
                                                           HorizontalOptions="Center" />
                                                </Border>
                                            </VerticalStackLayout>
                                        </Grid>
                                    </Border>
                                </SwipeView>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        
                        <CollectionView.EmptyView>
                            <VerticalStackLayout Spacing="16" 
                                                 Padding="40"
                                                 VerticalOptions="Center">
                                <Label Text="ðŸ’¸"
                                       FontSize="64"
                                       HorizontalOptions="Center"
                                       Opacity="0.3" />
                                <Label Text="Nenhuma transaÃ§Ã£o"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#111827"
                                       HorizontalOptions="Center" />
                                <Label Text="Adicione sua primeira transaÃ§Ã£o financeira"
                                       FontSize="14"
                                       TextColor="#6B7280"
                                       HorizontalOptions="Center"
                                       HorizontalTextAlignment="Center" />
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </RefreshView>

            </VerticalStackLayout>
        </Grid>

        <!-- BotÃ£o FAB -->
        <Border Grid.RowSpan="3"
                BackgroundColor="#6366F1"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 28"
                WidthRequest="56"
                HeightRequest="56"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,20,20">
            <Border.Shadow>
                <Shadow Brush="#6366F1" Opacity="0.4" Radius="16" Offset="0,4" />
            </Border.Shadow>
            
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding CreateTransactionCommand}" />
            </Border.GestureRecognizers>
            
            <Label Text="+"
                   FontSize="32"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   Margin="0,-2,0,0" />
        </Border>

        <!-- Loading Overlay -->
        <controls:LoadingOverlay Grid.RowSpan="3"
                                 IsVisible="{Binding IsBusy}"
                                 LoadingText="Carregando transaÃ§Ãµes..." />
    </Grid>

</ContentPage>
