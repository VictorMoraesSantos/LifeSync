<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:LifeSyncApp.ViewModels.Financial"
             xmlns:dto="clr-namespace:LifeSyncApp.DTOs.Financial.Category"
             x:Class="LifeSyncApp.Views.Financial.CategoriesPage"
             x:DataType="viewmodel:CategoriesViewModel"
             BackgroundColor="#FAFAFA"
             Title=""
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto, Auto, *">

        <Grid Grid.Row="0"
              ColumnDefinitions="Auto,*,Auto"
              Padding="16, 12"
              BackgroundColor="White">

            <HorizontalStackLayout Grid.Column="0"
                                   Spacing="6"
                                   VerticalOptions="Center">
                <HorizontalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoBackCommand}"/>
                </HorizontalStackLayout.GestureRecognizers>

                <Image Source="arrow_back.svg"
                       WidthRequest="16"
                       HeightRequest="16"
                       VerticalOptions="Center"/>

                <Label Text="Voltar"
                       TextColor="#6B7280"
                       FontSize="14"
                       VerticalOptions="Center"/>
            </HorizontalStackLayout>

            <HorizontalStackLayout Grid.Column="2"
                                   Spacing="6"
                                   VerticalOptions="Center"
                                   HeightRequest="44">
                <Image Source="label.svg"
                       WidthRequest="16"
                       HeightRequest="16"
                       VerticalOptions="Center"/>

                <Label Text="Categorias"
                       FontSize="16"
                       VerticalOptions="Center"/>
            </HorizontalStackLayout>
        </Grid>
        
        <BoxView Grid.Row="0"
                 HeightRequest="1"
                 Color="#E0E0E0"
                 VerticalOptions="End"/>

        <Border Grid.Row="1"
                Margin="16"
                BackgroundColor="#171717"
                StrokeShape="RoundRectangle 10"
                Padding="8,14">
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding AddCategoryCommand}"/>
            </Border.GestureRecognizers>

            <HorizontalStackLayout Spacing="8"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center">
                <Image Source="add.svg"
                       WidthRequest="20"
                       HeightRequest="20"/>

                <Label Text="Nova Categoria"
                       TextColor="White"
                       FontSize="16"
                       FontAttributes="Bold"/>
            </HorizontalStackLayout>
        </Border>

        <CollectionView Grid.Row="2"
                        ItemsSource="{Binding Categories}"
                        SelectionMode="None"
                        Margin="16,0,16,16">
            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center"
                                     VerticalOptions="Center"
                                     Spacing="12"
                                     Margin="0,40,0,0">
                    <Label Text="Nenhuma categoria criada"
                           FontSize="16"
                           TextColor="#737373"
                           HorizontalOptions="Center"/>

                    <Label Text="Toque em 'Nova Categoria' para criar sua primeira categoria"
                           FontSize="14"
                           TextColor="#A1A1A1"
                           HorizontalTextAlignment="Center"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="dto:CategoryDTO">
                    <Border BackgroundColor="White"
                            StrokeThickness="1"
                            Stroke="#E5E5E5"
                            StrokeShape="RoundRectangle 10"
                            Padding="13"
                            Margin="0,0,0,8">

                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">

                            <Image Grid.Column="0"
                                   Source="label.svg"
                                   WidthRequest="16"
                                   HeightRequest="16"
                                   VerticalOptions="Start"
                                   Margin="0,4,0,0"/>

                            <VerticalStackLayout Grid.Column="1" 
                                                 Spacing="2" 
                                                 VerticalOptions="Center">

                                <Label Text="{Binding Name}"
                                       FontSize="16"
                                       TextColor="#171717"/>

                                <Label Text="{Binding Description}"
                                       FontSize="14"
                                       TextColor="#737373"
                                       LineBreakMode="TailTruncation"
                                       IsVisible="{Binding Description, Converter={StaticResource HasItemsConverter}}"/>
                            </VerticalStackLayout>

                            <HorizontalStackLayout Grid.Column="2"
                                                   Spacing="4"
                                                   VerticalOptions="Center">

                                <Border WidthRequest="32"
                                        HeightRequest="32"
                                        StrokeShape="RoundRectangle 10"
                                        Stroke="Transparent"
                                        BackgroundColor="Transparent"
                                        VerticalOptions="Center">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:CategoriesViewModel}}, Path=EditCategoryCommand}"
                                                              CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>

                                    <Image Source="edit.svg"
                                           WidthRequest="16"
                                           HeightRequest="16"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>

                                <Border WidthRequest="32"
                                        HeightRequest="32"
                                        StrokeShape="RoundRectangle 10"
                                        Stroke="Transparent"
                                        BackgroundColor="Transparent"
                                        VerticalOptions="Center">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:CategoriesViewModel}}, Path=DeleteCategoryCommand}"
                                                              CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>

                                    <Image Source="trash.svg"
                                           WidthRequest="16"
                                           HeightRequest="16"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
